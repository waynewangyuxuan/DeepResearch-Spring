# TRAIL 三动作循环机制详解

**TRAIL 通过三个动作——Retrieve、Hypothesize、Synthesize——形成一个循环，反复执行直到 agent 对答案有足够信心。**

## Retrieve（检索）

Retrieve 是最直接的一步。Agent 拿到当前的 query，从中抽出关键实体，链接到知识图谱里的节点，然后沿着边往外扩展一到两跳，把周围的三元组拉回来组成一个局部子图。这些三元组被序列化成文本，塞进 LLM 的 context 里。这本质上就是标准的 KG 增强检索——实体链接加邻域扩展——这一步本身没有特别新的东西。Retrieve 真正的价值在于它之后发生的事情：系统能够识别出拉回来的子图不够用，从而触发下一个动作。

## Hypothesize（假设）

Hypothesize 是 TRAIL 真正有趣的地方。当检索回来的子图有缺口——比如两个实体都在图里，但它们之间没有边连接——agent 会把 query、已检索的子图和推理历史一起喂给 LLM，让它以候选三元组（subject, predicate, object）的形式**提出缺失的事实**。关键在于它不会盲目信任单次生成。它会在同一个 context 下多次采样（比如 5 次），每次可能生成不同的候选事实，然后用一个辅助模型（或同一个模型换个 prompt）做共识聚合。只有在多次采样中一致出现的事实才会被写入图谱。如果新提出的事实与图谱中已有的边矛盾，就触发冲突解决机制——比较置信度分数，低的那个被删除或标记为不确定。所以 Hypothesize 本质上是一个**有质量门控的 LLM 补全**：大胆猜测，严格验证。

## Synthesize（综合）

Synthesize 是 agent 尝试生成答案的动作。它把所有东西打包在一起——原始 query、检索回来的子图、新假设的三元组、完整的推理历史——然后生成一个回答。但 Synthesize 不一定是终点。系统会对生成的答案做一个**置信度评估**。如果置信度低于阈值，这个答案会被当作额外的上下文，循环重新开始：回到 Retrieve（现在有了更丰富的上下文），可能再来一轮 Hypothesize，再一次 Synthesize 尝试。只有当置信度超过阈值，循环才终止并输出最终答案。

## 总结

Retrieve 获取已知的，Hypothesize 填补缺失的，Synthesize 检验积累的知识是否足够。三者形成一个不断收紧的循环——每一轮迭代都可能改善图谱，让答案更接近确信。
